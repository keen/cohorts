<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cohort Builder by Keen IO</title>
  <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Raleway' />
  <link rel="stylesheet" href="./assets/bootstrap.min.css">
  <link rel="stylesheet" href="./assets/keen-static.css" />

  <!-- Cohort Matrix relies on the Keen IO Dataviz SDK -->
  <link href="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.0.4.css" rel="stylesheet" />
  <link rel="stylesheet" href="./assets/keen-cohort-builder.css">
</head>
<body class="application">

  <div class="masthead hero">
    <div class="container">

      <header class="navbar navbar-static">
        <div class="navbar-header">
          <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".keen-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="https://keen.io" class="navbar-brand" target="_blank">
            <svg class="keen-logo" xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 594 128" enable-background="new 0 0 594 128" xml:space="preserve">
              <g class="icon">
                <polygon class="red" fill="#FFFFFF" points="59.811,73.135 66.859,85.34 49.275,115.863 140.807,115.863 147.814,128 28.045,128"></polygon>
                <polygon class="green" fill="#FFFFFF" points="59.873,24.297 91.504,79.242 77.413,79.242 59.826,48.781 13.958,128 0,128"></polygon>
                <polygon class="blue" fill="#FFFFFF" points="133.769,103.674 70.364,103.674 77.418,91.432 112.586,91.432 66.915,12.1 73.9,0"></polygon>
              </g>
              <path class="text" fill="#FFFFFF" d="M246.12 94.163L216.29 57.373l27.704-27.484c1.199-1.195 1.782-2.475 1.782-3.91 0-2.906-2.496-5.453-5.341-5.453 -1.869 0-3.128 0.887-4.262 1.896l-43.89 44.996V26.094c0-3.07-2.498-5.568-5.568-5.568 -2.96 0-5.461 2.549-5.461 5.568v72.01c0 3.02 2.501 5.57 5.461 5.57 3.07 0 5.568-2.498 5.568-5.57V81.145l16.181-16.178 29.093 36.231c1.15 1.643 2.655 2.477 4.474 2.477 3.021 0 5.573-2.551 5.573-5.57C247.604 96.301 246.896 95.151 246.12 94.163zM309.211 71.702c0-15.379-9.767-30.948-28.434-30.948 -16.456 0-29.348 13.941-29.348 31.743v0.23c0 18.1 13.108 31.748 30.49 31.748 9.265 0 16.353-2.836 22.95-9.162 1.104-0.967 1.713-2.248 1.713-3.609 0-2.631-2.192-4.771-4.887-4.771 -1.466 0-2.503 0.719-3.195 1.293 -4.886 4.5-10.083 6.596-16.354 6.596 -10.378 0-18.167-7.188-19.675-18.006h41.627C306.917 76.815 309.211 74.52 309.211 71.702zM280.55 50.182c11.501 0 16.667 9.162 17.751 18.117h-35.831C263.956 57.574 271.266 50.182 280.55 50.182zM374.018 71.702c0-15.379-9.767-30.948-28.434-30.948 -16.454 0-29.344 13.941-29.344 31.743v0.23c0 18.1 13.107 31.748 30.486 31.748 9.263 0 16.351-2.836 22.95-9.164 1.103-0.965 1.71-2.246 1.71-3.607 0-2.631-2.193-4.771-4.889-4.771 -1.464 0-2.501 0.719-3.193 1.293 -4.886 4.5-10.082 6.596-16.352 6.596 -10.374 0-18.163-7.189-19.677-18.006h41.626C371.723 76.815 374.018 74.52 374.018 71.702zM345.357 50.182c11.497 0 16.662 9.162 17.749 18.117h-35.83C328.762 57.574 336.072 50.182 345.357 50.182zM414.734 40.754c-8.037 0-14.492 3.127-19.233 9.309V46.9c0-3.062-2.396-5.461-5.455-5.461 -2.945 0-5.342 2.449-5.342 5.461v51.319c0 3.059 2.396 5.455 5.455 5.455 3.045 0 5.342-2.346 5.342-5.455V68.271c0-10.312 6.874-17.514 16.717-17.514 9.606 0 15.342 6.291 15.342 16.826v30.635c0 3.059 2.398 5.455 5.461 5.455 2.999 0 5.348-2.396 5.348-5.455V65.414C438.369 50.434 429.092 40.754 414.734 40.754zM491.424 20.525c-2.958 0-5.457 2.549-5.457 5.568v72.01c0 3.02 2.499 5.57 5.457 5.57 3.072 0 5.572-2.498 5.572-5.57v-72.01C496.996 23.023 494.496 20.525 491.424 20.525zM552.307 19.725c-23.504 0-41.916 18.613-41.916 42.373v0.229c0 24.03 17.923 42.149 41.689 42.149 23.507 0 41.92-18.613 41.92-42.377v-0.227C594 37.844 576.076 19.725 552.307 19.725zM582.627 62.098v0.229c0 18.133-13.035 31.807-30.32 31.807 -17.411 0-30.541-13.773-30.541-32.036v-0.227c0-18.131 13.032-31.803 30.314-31.803C569.209 30.068 582.627 44.137 582.627 62.098z"></path>
            </svg>
          </a>
        </div>
        <nav class="navbar-collapse collapse keen-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav main-nav">
            <li><a href="https://github.com/keen/cohorts">Source Code</a></li>
            <li><a href="https://keen.chat">Chat Support</a></li>

          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://keen.io/signup?s=open-source-cohort" class="btn navbar-btn" target="_blank">Create a Free Project</a></li>
          </ul>
        </nav>
      </header>

      <h1>Cohorts by Keen IO</h1>
      <p class="lead">Quickly build and visualize beautiful cohort analyses</p>
      <a class="btn hero-btn" href="https://github.com/keen/cohorts" target="_blank">Source Code on Github</a>

      <iframe src="http://ghbtns.com/github-btn.html?user=keen&amp;repo=cohorts&amp;type=watch&amp;count=true"
        allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
      <iframe src="http://ghbtns.com/github-btn.html?user=keen&amp;repo=cohorts&amp;type=fork&amp;count=true"
        allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>

    </div>
  </div>

  <section class="announcement text-center" id="announcement-banner">
    <div class="container">
      <p>
        <span class="label label-success">JUST LAUNCHED</span>
        <strong>Check out this blog post for more info.</strong> Open Sourcing Cohort Analysis
        <a href="https://keen.io/blog/open-sourcing-cohort-analysis?s=open-source-cohort" target="_blank"><strong>Here </strong><span class="icon icon-arrow-right"></span></a>
      </p>
    </div>
  </section>

  <div class="container">
    <h1>Cohort Builder</h1>
    <form class="form-inline" role="form">
      <input id="select-step-intervals" type="number" class="form-control" min="5" max="10" value="5">
      <select id="select-step-units" class="form-control">
        <option value="days" disabled="disabled" >Days</option>
        <option value="weeks" selected="true">Weeks</option>
        <option value="months" disabled="disabled">Months</option>
      </select>
      <div class="btn-group">
        <button type="button" id="build" class="btn btn-default">Build</button>
      </div>
    </form>

    <div class="row">
      <div class="col-sm-6">
        <h3>Line chart</h3>
        <div id="new-chart-wrapper" class="demo-wrapper"></div>
      </div>
      <div class="col-sm-6">
        <h3>Heat map</h3>
        <div id="new-table-wrapper" class="demo-wrapper"></div>
      </div>
    </div>
  </div>
  <div class="copy">
    <br><p>
      Keen IO is an API for building analytics and reporting capabilities directly into your workflow, without having to build your own infrastructure. Learn more <a href="https://keen.io?s=open-source-cohort">here</a>.
    </p>
  </div>
  <div class="footer">
    <div class="container">
      <div class="love">
        <p>Made with &#9825; in San Francisco</p>
        <p>&copy; 2012&ndash;2016 <a href="https://keen.io">Keen IO</a></p>
      </div>
    </div>
  </div>

  <!-- Cohort Matrix relies on the Keen IO Analysis + Dataviz SDKs -->
  <script src="https://d26b395fwzu5fz.cloudfront.net/keen-analysis-1.1.0.js"></script>
  <script src="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.0.4.js"></script>
  <script src="./assets/keen-cohort-builder.js"></script>

  <!-- Stub requests for demo purposes -->
  <script src="./assets/keen-cohort-example.js"></script>
  <script>

  var keenClient = new Keen({
    projectId: 'YOUR_PROJECT_ID',
    readKey: 'YOUR_READ_KEY'
  });

  var cohortChart = new Keen.Dataviz()
    .el('#new-chart-wrapper')
    .height(280)
    .type('line');

  var cohortTable = new Keen.Dataviz()
    .el('#new-table-wrapper')
    .library('cohort-builder')
    .height(280)
    .type('matrix');

  var btn = document.getElementById('build');
  btn.onclick = function(e) {
    e.preventDefault();

    cohortChart.prepare();
    cohortTable.prepare();

    // Intervals input field
    var intervalsInput = document.getElementById('select-step-intervals');
    var intervals = parseInt(intervalsInput.value);

    // Units select field
    var unitsInput = document.getElementById('select-step-units');
    var units = unitsInput.options[unitsInput.selectedIndex].value;

    var dateMatrix = Keen.CohortBuilder.generateDateMatrix(units, intervals);

    var queryMatrix = Keen.CohortBuilder.generateCohortQueryMatrix(dateMatrix, function(cohort){
      return new Keen.Query('funnel', {
        steps: [
          {
            event_collection: 'first_launch',
            actor_property: 'dpid',
            filters: [
              { property_name: 'make', operator: 'eq', property_value: 'Apple' }
            ],
            timeframe: cohort.created_at
          },
          {
            event_collection: 'application_opened',
            actor_property: 'dpid',
            filters: [
              { property_name: 'make', operator: 'eq', property_value: 'Apple' }
            ],
            timeframe: cohort.current_interval
          }
        ]
      });
    });

    Keen.CohortBuilder.fetchCohortDatasets(keenClient, queryMatrix, function(dataset) {
      cohortChart
        .data(dataset)
        .render();

      cohortTable
        .data(dataset)
        .render();
    });
  };

  btn.click();
  </script>

  <!-- Analytics -->
  <script src="./assets/keen-tracking.js"></script>

</body>
</html>
